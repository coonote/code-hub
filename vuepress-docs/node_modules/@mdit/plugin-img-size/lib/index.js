const b=(e,o,m)=>{let l;const i=o,u={ok:!1,pos:o,value:""};for(l=e.charAt(o);o<m&&/\d/.test(l)||l==="%";)l=e.charAt(++o);return u.ok=!0,u.pos=o,u.value=e.slice(i,o),u},z=(e,o,m)=>{const l={ok:!1,pos:0,width:"",height:""};if(o>=m||e.charAt(o)!=="=")return l;o++;const i=e.charAt(o);if(i!=="x"&&!/\d/.test(i))return l;const u=b(e,o,m);if(o=u.pos,e.charAt(o)!=="x")return l;o++;const a=b(e,o,m);return o=a.pos,l.width=u.value,l.height=a.value,l.pos=o,l.ok=!0,l},w=(e,o)=>{const m=e.env,l=e.pos,i=e.posMax;if(e.src.charAt(e.pos)!=="!"||e.src.charAt(e.pos+1)!=="[")return!1;const u=e.pos+2,a=e.md.helpers.parseLinkLabel(e,e.pos+1,!1);if(a<0)return!1;let s=a+1,t,f="",h="",c="",r="";if(s<i&&e.src.charAt(s)==="("){for(s++;s<i&&(t=e.src.charAt(s),!(t!==" "&&t!=="	"));)s++;if(s>=i)return!1;let n;n=e.md.helpers.parseLinkDestination(e.src,s,e.posMax),n.ok&&(f=e.md.normalizeLink(n.str),e.md.validateLink(f)?s=n.pos:f="");const p=s;for(;s<i&&(t=e.src.charAt(s),!(t!==" "&&t!=="	"));s++);if(n=e.md.helpers.parseLinkTitle(e.src,s,e.posMax),s<i&&p!==s&&n.ok)for(h=n.str,s=n.pos;s<i&&(t=e.src.charAt(s),!(t!==" "&&t!=="	"));s++);else h="";if(s-1>=0&&(t=e.src.charAt(s-1),t===" "&&(n=z(e.src,s,e.posMax),n.ok)))for(c=n.width,r=n.height,s=n.pos;s<i&&(t=e.src.charAt(s),!(t!==" "&&t!==`
`));s++);if(s>=i||e.src.charAt(s)!==")")return e.pos=l,!1;s++}else{let n="";if(typeof m.references>"u")return!1;for(;s<i&&(t=e.src.charAt(s),!(t!==" "&&t!=="	"));s++);if(s<i&&e.src.charAt(s)==="["){const d=s+1;s=e.md.helpers.parseLinkLabel(e,s),s>=0?n=e.src.slice(d,s++):s=a+1}else s=a+1;n||(n=e.src.slice(u,a));const p=m.references[e.md.utils.normalizeReference(n)];if(!p)return e.pos=l,!1;f=p.href,h=p.title??""}if(!o){const n=e.src.slice(u,a),p=[];e.md.inline.parse(n,e.md,e.env,p);const d=e.push("image","img",0),A=[["src",f],["alt",""]];h&&A.push(["title",h]),c&&A.push(["width",c]),r&&A.push(["height",r]),d.attrs=A,d.children=p,d.content=n}return e.pos=s,e.posMax=i,!0},R=e=>{e.inline.ruler.before("emphasis","image",w)},S=/^(.*?)\|\s*(\d+)\s*x\s*(\d+)\s*$/,v=(e,o)=>{const m=e.env,l=e.pos,i=e.posMax;if(e.src.charAt(e.pos)!=="!"||e.src.charAt(e.pos+1)!=="[")return!1;const u=e.pos+2,a=e.md.helpers.parseLinkLabel(e,e.pos+1,!1);if(a<0)return!1;let s=a+1,t,f="",h="";if(s<i&&e.src.charAt(s)==="("){for(s++;s<i&&(t=e.src.charAt(s),!(t!==" "&&t!=="	"));)s++;if(s>=i)return!1;let c;c=e.md.helpers.parseLinkDestination(e.src,s,e.posMax),c.ok&&(f=e.md.normalizeLink(c.str),e.md.validateLink(f)?s=c.pos:f="");const r=s;for(;s<i&&(t=e.src.charAt(s),!(t!==" "&&t!=="	"));s++);if(c=e.md.helpers.parseLinkTitle(e.src,s,e.posMax),s<i&&r!==s&&c.ok)for(h=c.str,s=c.pos;s<i&&(t=e.src.charAt(s),!(t!==" "&&t!=="	"));s++);else h="";if(s>=i||e.src.charAt(s)!==")")return e.pos=l,!1;s++}else{let c="";if(typeof m.references>"u")return!1;for(;s<i&&(t=e.src.charAt(s),!(t!==" "&&t!=="	"));s++);if(s<i&&e.src.charAt(s)==="["){const n=s+1;s=e.md.helpers.parseLinkLabel(e,s),s>=0?c=e.src.slice(n,s++):s=a+1}else s=a+1;c||(c=e.src.slice(u,a));const r=m.references[e.md.utils.normalizeReference(c)];if(!r)return e.pos=l,!1;f=r.href,h=r.title??""}if(!o){let c=e.src.slice(u,a);const r=S.exec(c),n=e.push("image","img",0),p=[["src",f],["alt",""]];if(h&&p.push(["title",h]),r){const[,A,k,L]=r,g=Number(k),x=Number(L);(g||x)&&(c=A.trim(),g&&p.push(["width",k]),x&&p.push(["height",L]))}const d=[];e.md.inline.parse(c,e.md,e.env,d),n.attrs=p,n.children=d,n.content=c}return e.pos=s,e.posMax=i,!0},y=e=>{e.inline.ruler.before("emphasis","image",v)},I=/^(.*?)\s+=(\d*)\s*(?:x(\d*))?$/,M=(e,o)=>{const m=e.env,l=e.pos,i=e.posMax;if(e.src.charAt(e.pos)!=="!"||e.src.charAt(e.pos+1)!=="[")return!1;const u=e.pos+2,a=e.md.helpers.parseLinkLabel(e,e.pos+1,!1);if(a<0)return!1;let s=a+1,t,f="",h="";if(s<i&&e.src.charAt(s)==="("){for(s++;s<i&&(t=e.src.charAt(s),!(t!==" "&&t!=="	"));)s++;if(s>=i)return!1;let c;c=e.md.helpers.parseLinkDestination(e.src,s,e.posMax),c.ok&&(f=e.md.normalizeLink(c.str),e.md.validateLink(f)?s=c.pos:f="");const r=s;for(;s<i&&(t=e.src.charAt(s),!(t!==" "&&t!=="	"));s++);if(c=e.md.helpers.parseLinkTitle(e.src,s,e.posMax),s<i&&r!==s&&c.ok)for(h=c.str,s=c.pos;s<i&&(t=e.src.charAt(s),!(t!==" "&&t!=="	"));s++);else h="";if(s>=i||e.src.charAt(s)!==")")return e.pos=l,!1;s++}else{let c="";if(typeof m.references>"u")return!1;for(;s<i&&(t=e.src.charAt(s),!(t!==" "&&t!=="	"));s++);if(s<i&&e.src.charAt(s)==="["){const n=s+1;s=e.md.helpers.parseLinkLabel(e,s),s>=0?c=e.src.slice(n,s++):s=a+1}else s=a+1;c||(c=e.src.slice(u,a));const r=m.references[e.md.utils.normalizeReference(c)];if(!r)return e.pos=l,!1;f=r.href,h=r.title??""}if(!o){let c=e.src.slice(u,a);const r=I.exec(c),n=e.push("image","img",0),p=[["src",f],["alt",""]];if(h&&p.push(["title",h]),r){const[,A,k,L]=r;(k||L)&&(c=A.trim(),k&&p.push(["width",k]),L&&p.push(["height",L]))}const d=[];e.md.inline.parse(c,e.md,e.env,d),n.attrs=p,n.children=d,n.content=c}return e.pos=s,e.posMax=i,!0},D=e=>{e.inline.ruler.before("emphasis","image",M)};export{D as imgSize,M as imgSizeRule,R as legacyImgSize,y as obsidianImgSize,v as obsidianImgSizeRule};
//# sourceMappingURL=index.js.map
